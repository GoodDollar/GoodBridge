FROM node:16-alpine as build
WORKDIR /app

COPY ./package.json .
RUN yarn install

COPY ./ ./
RUN yarn build:release
RUN rm -fr node_modules
RUN yarn install --production

FROM gcr.io/distroless/nodejs:16
ENV POLLING_INTERVAL=5000
ENV LOG_LEVEL=info
ENV REGISTRY_RPC=http://172.17.0.1:8545
ENV FUSE_RPC=http://172.17.0.1:8545
ENV OLD_BLOCK_REGISTRY_ADDRESS=0x0602b55F96eC0d347E5123C556272015fFee9fC5
ENV BLOCK_REGISTRY_ADDRESS=0x44a1E0A83821E239F9Cef248CECc3AC5b910aeD2
ENV CONSENSUS_ADDRESS=0x3014ca10b91cb3D0AD85fEf7A3Cb95BCAc9c0f79
ENV BRIDGES='[{"122":"0x00D6017Bf36Cb32B3Fc5C1c91EfAF958096Eb285","42220":"0x4865aFc4a6Ccf36415dC5c012AE23F31fD70Ee70"},{"122":"0x499b2280a8A3319Af74d0eF008Fa83ea87b8626F","42220":"0x34cf3a1102384f9E6B071fD339f06bBAFA6C753f"}]'
ENV TEST_MODE=false
ENV STEP_SIZE=10
ENV CONFIG_DIR=/config/
COPY --from=build /app /app
WORKDIR /app
CMD ["dist/main.js"]

